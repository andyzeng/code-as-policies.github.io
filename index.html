<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>Code as Policies: Language Model Programs for Embodied Control</title>

    <meta name="description" content="Code as Policies: Language Model Programs for Embodied Control">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- <base href="/"> -->

        <!--FACEBOOK-->
    <meta property="og:image" content="https://code-as-policies.github.io/img/share_image.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="682">
    <meta property="og:image:height" content="682">
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://code-as-policies.github.io/"/>
    <meta property="og:title" content="Code as Policies" />
    <meta property="og:description" content="Project page for Code as Policies: Language Model Programs for Embodied Control." />

        <!--TWITTER-->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Code as Policies" />
    <meta name="twitter:description" content="Project page for Code as Policies: Language Model Programs for Embodied Control." />
    <meta name="twitter:image" content="https://code-as-policies.github.io/img/share_image.png" />

<!--     <link rel="apple-touch-icon" href="apple-touch-icon.png"> -->
  <!-- <link rel="icon" type="image/png" href="img/seal_icon.png"> -->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.8.0/codemirror.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
    <link rel="stylesheet" href="css/app.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.8.0/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.3/clipboard.min.js"></script>
    
    <script src="js/app.js"></script>
	
    <style>
        .nav-pills {
          position: relative;
          display: inline;
        }
        .imtip {
          position: absolute;
          top: 0;
          left: 0;
        }
    </style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5JBS73F70V"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5JBS73F70V');
</script>
<body>
    <div class="container" id="main">
        <div class="row mt-4">
            <h2 class="col-md-12 text-center">
                <b><font size="+6">Code as Policies</font></b>: </br> Language Model Programs for Embodied Control </br> 
                <!--<small>
                    ICRA 2023
                </small>-->
            </h2>
        </div>
        
        <div class="row">
            <div class="col-md-12 text-center">
                <ul class="list-inline">
                <br>
                <li>Jacky Liang</li>
                <li>Wenlong Huang</li>
                <li>Fei Xia</li>
                <li>Peng Xu</li>
                <li>Karol Hausman</li>
                <li>Brian Ichter</li>
                <li>Pete Florence</li>
                <li>Andy Zeng</li>
                <br>
                <br>
                    <a href="http://g.co/robotics">
                        <image src="img/robotics-at-google.png" height="40px"> 
                        Robotics at Google                        
                    </a>
                </ul>
            </div>
        </div>

        <div class="row justify-content-md-center">
            <div class="col-md-2 text-center">
                <!-- <a href="assets/palm_saycan.pdf"> -->
                <image src="img/paper_small.png" height="60px">
                <!-- <image src="img/new.png" height="20px" class="imtip"> -->
                <h4><strong>Paper</strong></h4>
                <!-- </a> -->
            </div>
            <div class="col-md-2 text-center">
                <a href="https://github.com/google-research/google-research/tree/master/code_as_policies">
                <image src="img/github.png" height="60px">
                <!-- <image src="img/new.png" height="20px" class="imtip"> -->
                <h4><strong>Code</strong></h4>
                </a>
            </div>
            <!-- <li>
                        <a href="https://youtu.be/ysFav0b472w">
                        <image src="img/youtube_icon.png" height="60px">
                            <h4><strong>Video</strong></h4>
                        </a>
                    </li>
                    <li>
                        <a href="https://ai.googleblog.com/2022/08/towards-helpful-robots-grounding.html">
                        <image src="img/google-ai-blog-small.png" height="60px">
                            <image src="img/new.png" height="20px" class="imtip">
                            <h4><strong>Blogpost</strong></h4>
                        </a>
                    </li>
                    <li>
                        <a href="https://sites.research.google/palm-saycan">
                        <image src="img/demo.png" height="60px">
                            <image src="img/new.png" height="20px" class="imtip">
                            <h4><strong>Demo</strong></h4>
                        </a>
                    </li>  -->
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <video id="v0" width="100%" preload="auto" playsinline muted loop autoplay>
                    <source src="videos/tasks.mp4" type="video/mp4">
                </video>
            </div>
        </div>

        <div class="row justify-content-md-center">
            <div class="col-md-10 col-lg-8">
                <h3 class="mt-4 mb-2">
                    Abstract
                </h3>
                <p class="text-justify">
Large language models (LLMs) trained on codecompletion have been shown to be capable of synthesizing simple Python programs from docstrings [1]. 
We find that these codewriting LLMs can be re-purposed to write robot policy code, given natural language commands. 
Specifically, policy code can express functions or feedback loops that process perception outputs (e.g.,from object detectors [2], [3]) and parameterize control primitive APIs.
When provided as input several example language commands (formatted as comments) followed by corresponding policy code (via few-shot prompting), LLMs can take in new commands and autonomously re-compose API calls to generate new policy code respectively. 
By chaining classic logic structures and referencing third-party libraries (e.g., NumPy, Shapely) to perform arithmetic, LLMs used in this way can write robot policies that (i) exhibit spatial-geometric reasoning, (ii) generalize to new instructions, and (iii) prescribe precise values (e.g., velocities) to ambiguous descriptions (“faster”) depending on context (i.e., behavioral commonsense). 
This paper presents code as policies: a robot-centric formalization of language model generated programs (LMPs) that can represent reactive policies (e.g., impedance controllers), as well as waypoint-based policies (vision-based pick and place, trajectory-based control), demonstrated across multiple real robot platforms. Central to our approach is prompting hierarchical code-gen (recursively defining undefined functions), which can write more complex code and also improves state-of-the-art to solve 39.8% of problems on the HumanEval [1] benchmark. 
Code and videos are available at https://code-as-policies.github.io
                </p>
                <p style="text-align:center;">
                    <image src="img/share_image.png" width="100%">
                </p>
                <div class="col-md-12">
                    <video id="v0" width="100%" preload="auto" playsinline controls>
                        <source src="videos/3_min_explainer.mp4" type="video/mp4">
                    </video>
                </div>
            </div>
        </div>

        <div class="row justify-content-md-center">
            <div class="col-md-10 col-lg-8">
                <!-- <h3>
                    Approach
                </h3> -->
                <!-- <p class="text-justify">
                    Imagine a robot operating in a kitchen that is capable of executing skills such as "pick up the coffee cup" or "go to the sink".
                    To get the robot to use these skills to perform a complex task (e.g. "I spilled my drink, can you help?"), the user could manually break it up into steps consisting of these atomic commands. 
			        However,this would be exceedingly tedious. A language model can split the high-level instruction ("I spilled my drink, can you help?") into sub-tasks, but it cannot do that effectively unless it has the context of what the robot is capable of given the abilities, current state of the robot and its environment.
                <br><br>
                    When querying existing large language models, we see that a language model queried with "I spilled my drink, can you help?" may respond with "You could try using a vaccuum cleaner" or "I'm sorry, I didn't mean to spill it".
                <p style="text-align:center;">
        	        <image src="img/gpt3-cropped2.png" class="img-responsive">
                </p>
                    While these responses sound reasonable, they are not feasible to execute with the robot's capabilities in its current environment.  
                <br><br>
                    The main principle that we use to connect LLMs to physical tasks is to observe that, in addition of asking the LLM to simply interpret an instruction, we can use it to score the likelihood that an individual skill makes progress towards completing the high-level instruction.
                    Furthermore, if each skill has an accompanying affordance function that quantifies how likely it is to succeed from the current state (such as a learned value function), its value can be used to weight the skill's likelihood.
                <p style="text-align:center;">
        	        <image src="img/saycan-llm.gif" class="img-responsive">
                </p>
                <br><br>
                    Once the skill is selected, we execute it on the robot, the process proceeds by iteratively selecting a task and appending it to the instruction.
                    Practically, we structure the planning as a dialog between a user and a robot, in which a user provides the high level-instruction, e.g. "How would you bring me a coke can?" and the language model responds with an explicit sequence e.g. "I would: 1. Find a coke can, 2. Pick up the coke can, 3. Bring it to you, 4. Done".  
                <p style="text-align:center;">
        	        <image src="img/saycan.png" class="img-responsive">        	   
                </p>
                In summary, given a high-level instruction, SayCan combines probabilities from a language model (representing the probability that a skill is useful for the instruction) with the probabilities from a value function (representing the probability of successfully executing said skill) to select the skill to perform. This emits a skill that is both possible and useful. The process is repeated by appending the selected skill to robot response and querying the models again, until the output step is to terminate.                 -->
            </div>
        </div>

        <div class="row justify-content-md-center mt-4">
            <div class="col-md-10 col-lg-8">
                <h3>Experiment Videos and Generated Code</h3>
                <p>Videos have sound that showcase voice and speech-based robot interface.</p>
                <p>Long pauses between commands and responses are mostly caused by OpenAI API query times and rate limiting.</p>
                <div class="card mb-4 mt-4 text-dark bg-light">
                    <h5 class="card-header">Tabletop Manipulation: Blocks</h5>
                    <div class="card-body">
                        <p>Choose a command:</p>
                        <select class="form-select" size="5" aria-label="size 5 select example">
                            <option value="blocks_1">
                                1) Put the blocks in a horizontal line near the top
                            </option>
                            <option value="blocks_2">
                                2) Move the sky-colored block in between the red block and the second block from the left
                            </option>
                            <option value="blocks_3">
                                3) Why did you move the green block?
                            </option>
                            <option value="blocks_4">
                                4) Which block did you move?
                            </option>
                            <option value="blocks_5">
                                5) Arrange the blocks in a square around the middle
                            </option>
                            <option value="blocks_6">
                                6) Make the square bigger
                            </option>
                            <option value="blocks_7">
                                7) Undo that
                            </option>
                            <option value="blocks_8">
                                8) Rotate the square by 45 degrees
                            </option>
                            <option value="blocks_9">
                                9) Can you throw blocks?
                            </option>
                            <option value="blocks_10">
                                10) Move the red block 5cm to the bottom
                            </option>
                            <option value="blocks_11">
                                11) Do the same with the other blocks
                            </option>
                            <option value="blocks_12">
                                12) Put the blocks on different corners clockwise starting at the top right corner
                            </option>
                        </select>
                        <div class="col-md-12 mb-2">
                            <video id="vid_blocks" width="100%" preload="auto" playsinline controls>
                                <source src="videos/blocks.mp4" type="video/mp4">
                            </video>
                        </div>

                        <div class="row" id="content_blocks_1">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'orange block']
# put the blocks in a horizontal line near the top.
say('Ok - putting the blocks in a horizontal line near the top')
block_names = parse_obj_name('the blocks', f'objects = {get_obj_names()}')
line_pts = parse_position(f'a horizontal line near the top with {len(block_names)} points')
for block_name, pt in zip(block_names, line_pts):
    put_first_on_second(block_name, pt)

objects = ['red block', 'green block', 'blue block', 'orange block']
# the blocks.
ret_val = ['red block', 'green block', 'blue block', 'orange block']

# a horizontal line near the top with 4 points.
top_pos = denormalize_xy([0.5, 1])
start_pos = top_pos + [-0.3/2, 0]
end_pos = top_pos + [0.3/2, 0]
line = make_line(start=start_pos, end=end_pos)
points = interpolate_pts_on_line(line=line, n=4)
ret_val = points

def make_line(start, end):
    line = LineString([start, end])
    return line

def interpolate_pts_on_line(line, n):
    pts = []
    for i in range(n):
        t = i / (n - 1)
        pt = interpolate_line(line, t)
        pts.append(pt)
    return np.array(pts)
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocks_2" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'orange block']
# move the sky color block in between the red block and the second block from the left.
say('Ok - putting the blue block in between the red block and the second block from the left')
target_pos = parse_position('a point in the middle between the red block and the second block from the left')
put_first_on_second('blue block', target_pos)

# a point in the middle between the red block and the second block from the left.
red_block_name = parse_obj_name('the red block', f'objects = {get_obj_names()}')
second_block_name = parse_obj_name('the second block from the left', f'objects = {get_obj_names()}')
red_block_pos = get_obj_pos(red_block_name)
second_block_pos = get_obj_pos(second_block_name)
ret_val = (red_block_pos + second_block_pos) / 2

objects = ['red block', 'green block', 'blue block', 'orange block']
# the red block.
ret_val = 'red block'

objects = ['red block', 'green block', 'blue block', 'orange block']
# the second block from the left.
block_names = ['red block', 'green block', 'blue block', 'orange block']
block_positions = get_obj_positions_np(block_names)
left_block_idx = np.argsort(block_positions[:, 0])[1]
left_block_name = block_names[left_block_idx]
ret_val = left_block_name

# define function: block_positions = get_obj_positions_np(block_names).
def get_obj_positions_np(obj_names):
    obj_positions = []
    for obj_name in obj_names:
        obj_positions.append(get_obj_pos(obj_name))
    return np.array(obj_positions)
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocks_3" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'orange block']
# why did you move the green block.
say('I did not move the green block')                                    
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocks_4" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'orange block']
# which block did you move.
say('I moved the blue block')                                                                      
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocks_5" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'orange block']
# arrange the blocks in a square around the middle.
say('Ok - arranging the blocks in a square around the middle')
block_names = parse_obj_name('the blocks', f'objects = {get_obj_names()}')
square_pts = parse_position(f'a square with size 10cm around the middle with {len(block_names)} points')
for block_name, pt in zip(block_names, square_pts):
    put_first_on_second(block_name, pt)

objects = ['red block', 'green block', 'blue block', 'orange block']
# the blocks.
ret_val = ['red block', 'green block', 'blue block', 'orange block']

# a square with size 10cm around the middle with 4 points.
polygon = make_square(size=0.1, center=denormalize_xy([0.5, 0.5]))
points = get_points_from_polygon(polygon)
ret_val = points

# define function; polygon = make_square(size=0.1, center=denormalize_xy([0.5, 0.5])).
def make_square(size, center):
    square = Polygon([
        center + [-size/2, -size/2],
        center + [size/2, -size/2], 
        center + [size/2, size/2], 
        center + [-size/2, size/2]
    ])
    return square

# define function; points = get_points_from_polygon(polygon).
def get_points_from_polygon(shape):
    return np.array(shape.exterior.coords)
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocks_6" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'orange block']
# make the square bigger.
say('Ok - making the square bigger')
block_names = parse_obj_name('the blocks', f'objects = {get_obj_names()}')
square_pts = parse_position(f'a square with size 20cm around the middle with {len(block_names)} points')
for block_name, pt in zip(block_names, square_pts):
    put_first_on_second(block_name, pt)

objects = ['red block', 'green block', 'blue block', 'orange block']
# the blocks.
ret_val = ['red block', 'green block', 'blue block', 'orange block']

polygon = make_square(size=0.2, center=denormalize_xy([0.5, 0.5]))
points = get_points_from_polygon(polygon)
ret_val = points                                    
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocks_7" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'orange block']
# undo that.
say('Ok - making the square smaller')
block_names = parse_obj_name('the blocks', f'objects = {get_obj_names()}')
square_pts = parse_position(f'a square with size 10cm around the middle with {len(block_names)} points')
for block_name, pt in zip(block_names, square_pts):
    put_first_on_second(block_name, pt)

objects = ['red block', 'green block', 'blue block', 'orange block']
# the blocks.
ret_val = ['red block', 'green block', 'blue block', 'orange block']

# a square with size 10cm around the middle with 4 points.
polygon = make_square(size=0.1, center=denormalize_xy([0.5, 0.5]))
points = get_points_from_polygon(polygon)
ret_val = points                                                                 
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocks_8" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'orange block']
# rotates the square by 45 degrees.
say('Ok - rotating the square by 45 degrees')
block_names = parse_obj_name('the blocks', f'objects = {get_obj_names()}')
square_pts = parse_position(f'a square with size 10cm around the middle with {len(block_names)} points rotated by 45 degrees')
for block_name, pt in zip(block_names, square_pts):
    put_first_on_second(block_name, pt)

objects = ['red block', 'green block', 'blue block', 'orange block']
# the blocks.
ret_val = ['red block', 'green block', 'blue block', 'orange block']

# a square with size 10cm around the middle with 4 points rotated by 45 degrees.
polygon = make_square(size=0.1, center=denormalize_xy([0.5, 0.5]))
polygon = rotate(polygon, 45)
points = get_points_from_polygon(polygon)
ret_val = points                                                                                                
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocks_9" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'orange block']
# can you throw blocks.
say('no, I can only move objects around')                                                                                                                     
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocks_10" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'orange block']
# move the red block 5 cm to the bottom.
say('Ok - moving the red block 5cm to the bottom')
target_pos = parse_position('a point 5cm below the red block')
put_first_on_second('red block', target_pos)

# a point 5cm below the red block.
block_name = parse_obj_name('the red block', f'objects = {get_obj_names()}')
ret_val = get_obj_pos(block_name) + [0, -0.05]

objects = ['red block', 'green block', 'blue block', 'orange block']
# the red block.
ret_val = 'red block'                                                                                                                                                      
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocks_11" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'orange block']
# do the same with the other blocks.
say('Ok - moving the other blocks 5cm to the bottom')
block_names = parse_obj_name('the blocks other than the red block', f'objects = {get_obj_names()}')
for block_name in block_names:
    target_pos = parse_position(f'a point 5cm below the {block_name}')
    put_first_on_second(block_name, target_pos)

objects = ['red block', 'green block', 'blue block', 'orange block']
# the blocks other than the red block.
ret_val = ['green block', 'blue block', 'orange block']

# a point 5cm below the green block.
block_name = parse_obj_name('the green block', f'objects = {get_obj_names()}')
ret_val = get_obj_pos(block_name) + [0, -0.05]

objects = ['red block', 'green block', 'blue block', 'orange block']
# the green block.
ret_val = 'green block'

# a point 5cm below the blue block.
block_name = parse_obj_name('the blue block', f'objects = {get_obj_names()}')
ret_val = get_obj_pos(block_name) + [0, -0.05]

objects = ['red block', 'green block', 'blue block', 'orange block']
# the blue block.
ret_val = 'blue block'

# a point 5cm below the orange block.
block_name = parse_obj_name('the orange block', f'objects = {get_obj_names()}')
square_pos = get_obj_pos(block_name)
ret_val = square_pos + [0, -0.05]

objects = ['red block', 'green block', 'blue block', 'orange block']
# the orange block.
ret_val = 'orange block'                                                                                                                                                                                        
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocks_12" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'orange block']
# put the blocks on different corners clockwise starting at the top right corner.
say('Ok - putting the blocks on different corners clockwise starting at the top right corner')
block_names = parse_obj_name('the blocks', f'objects = {get_obj_names()}')
corners = parse_position('the corners clockwise starting at the top right corner')
for block_name, pos in zip(block_names, corners):
    put_first_on_second(block_name, pos)

objects = ['red block', 'green block', 'blue block', 'orange block']
# the blocks.
ret_val = ['red block', 'green block', 'blue block', 'orange block']

# the corners clockwise starting at the top right corner.
top_right_pos = denormalize_xy([1, 1])
bottom_right_pos = denormalize_xy([1, 0])
bottom_left_pos = denormalize_xy([0, 0])
top_left_pos = denormalize_xy([0, 1])
ret_val = [top_right_pos, bottom_right_pos, bottom_left_pos, top_left_pos]
                                </code></pre>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="card mb-4 mt-4 text-dark bg-light">
                    <h5 class="card-header">Tabletop Manipulation: Blocks and Bowls </h5>
                    <div class="card-body">
                        <p>Choose a command:</p>
                        <select class="form-select" size="5" aria-label="size 5 select example">
                            <option value="blocksbowls_1">
                                1) Put the red block to the left of the rightmost bowl
                            </option>
                            <option value="blocksbowls_2">
                                2) Now move it to the side farthest away from it
                            </option>
                            <option value="blocksbowls_3">
                                3) How many bowls are to the left of the red block?
                            </option>
                            <option value="blocksbowls_4">
                                4) Place the blocks in bowls with non matching colors
                            </option>
                            <option value="blocksbowls_5">
                                5) Put the blocks in a vertical line 20 cm long and 10 cm below the blue bowl
                            </option>
                            <option value="blocksbowls_6">
                                6) Imagine that the bowls represent a volcano, a forest, and an ocean
                            </option>
                            <option value="blocksbowls_7">
                                7) Also imagine that the blocks are parts of a building
                            </option>
                            <option value="blocksbowls_8">
                                8) Now build a tower in the forest
                            </option>
                            <option value="blocksbowls_9">
                                9) Show me what happens when a volcano erupts over the ocean
                            </option>
                        </select>

                        <div class="col-md-12 mb-2">
                            <video id="vid_blocksbowls" width="100%" preload="auto" playsinline controls>
                                <source src="videos/blocks_and_bowls.mp4" type="video/mp4">
                            </video>
                        </div>

                        <div class="row" id="content_blocksbowls_1">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# put the red block to the left of the rightmost bowl.
rightmost_bowl_name = parse_obj_name('the rightmost bowl', f'objects = {get_obj_names()}')
if rightmost_bowl_name:
    say(f'Putting the red block to the left of the {rightmost_bowl_name}')
    left_pos = parse_position(f'a point 10cm left of the {rightmost_bowl_name}')
    put_first_on_second('red block', left_pos)
else:
    say('There are no bowls')

objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# the rightmost bowl.
bowl_names = ['red bowl', 'green bowl', 'blue bowl']
bowl_positions = get_obj_positions_np(bowl_names)
right_bowl_idx = get_right_most_idx(bowl_positions)
right_bowl_name = bowl_names[right_bowl_idx]
ret_val = right_bowl_name

# a point 10cm left of the blue bowl.
blue_bowl_name = parse_obj_name('blue bowl', f'objects = {get_obj_names()}')
blue_bowl_pos = get_obj_pos(blue_bowl_name)
left_obj_pos = blue_bowl_pos + [-0.1, 0]
ret_val = left_obj_pos

objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# blue bowl.
ret_val = 'blue bowl'

# define function: bowl_positions = get_obj_positions_np(bowl_names).
def get_obj_positions_np(obj_names):
    obj_positions = []
    for obj_name in obj_names:
        obj_positions.append(get_obj_pos(obj_name))
    return np.array(obj_positions)

# define function: right_bowl_idx = get_right_most_idx(bowl_positions).
def get_right_most_idx(points):
    return np.argmax(points[:, 0])                                
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocksbowls_2" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# now move it to the side farthest away from it.
say('Moving the red block to the side farthest away from it')
farthest_side_pos = parse_position('the side farthest away from the red block')
put_first_on_second('red block', farthest_side_pos)

# the side farthest away from the red block.
block_name = parse_obj_name('red block', f'objects = {get_obj_names()}')
side_positions = np.array([denormalize_xy(pos) for pos in [[0.5, 0], [0.5, 1], [1, 0.5], [0, 0.5]]])
farthest_side_pos = get_farthest_point(points=side_positions, point=get_obj_pos(block_name))
ret_val = farthest_side_pos

objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# red block.
ret_val = 'red block'

# define function: farthest_side_pos = get_farthest_point(points=side_positions, point=get_obj_pos(block_name)).
def get_farthest_point(points, point):
    closest_point = points[np.argmax(np.linalg.norm(points - point, axis=1))]
    return closest_point
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocksbowls_3" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# how many bowls are to the left of the red block.
n_left_bowls = parse_question('how many bowls are to the left of the red block', f'objects = {get_obj_names()}')
say(f'There are {n_left_bowls} bowls to the left of the red block')

objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# how many bowls are to the left of the red block?
red_block_pos = get_obj_pos('red block')
bowl_names = parse_obj_name('the bowls', f'objects = {get_obj_names()}')
left_bowl_names = []
for bowl_name in bowl_names:
    if get_obj_pos(bowl_name)[0] < red_block_pos[0]:
    left_bowl_names.append(bowl_name)
ret_val = len(left_bowl_names)

objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# the bowls.
ret_val = ['red bowl', 'green bowl', 'blue bowl']                                    
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocksbowls_4" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# place the blocks in bowls with non matching colors.
say('Ok - placing the blocks in bowls with non matching colors')
matches = {'red block': 'blue bowl', 'green block': 'red bowl', 'blue block': 'green bowl'}
for first, second in matches.items():
    put_first_on_second(first, get_obj_pos(second))                                                                     
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocksbowls_5" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# put the blocks in a vertical line 20 cm long and 10 cm below the blue bowl.
say('Ok - putting the blocks in a vertical line 20 cm long and 10 cm below the blue bowl')
block_names = parse_obj_name('the blocks', f'objects = {get_obj_names()}')
line_pts = parse_position(f'a 20cm vertical line 10cm below the blue bowl with {len(block_names)} points')
for block_name, pt in zip(block_names, line_pts):
    put_first_on_second(block_name, pt)

objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# the blocks.
ret_val = ['red block', 'green block', 'blue block']

# a 20cm vertical line 10cm below the blue bowl with 3 points.
blue_bowl_name = parse_obj_name('blue bowl', f'objects = {get_obj_names()}')
blue_bowl_pos = get_obj_pos(blue_bowl_name)
start_pos = blue_bowl_pos + [0, -0.1]
end_pos = blue_bowl_pos + [0, -0.1-0.2]
line = make_line(start=start_pos, end=end_pos)
points = interpolate_pts_on_line(line=line, n=3)
ret_val = points

objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# blue bowl.
ret_val = 'blue bowl'    

# define function: line = make_line(start=start_pos, end=end_pos).
def make_line(start, end):
  line = LineString([start, end])
  return line

# define function: points = interpolate_pts_on_line(line=line, n=3).
def interpolate_pts_on_line(line, n):
  pts = []
  for i in range(n):
      t = i / (n - 1)
      pt = interpolate_line(line, t)
      pts.append(pt)
  return np.array(pts)
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocksbowls_6" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# imagine did the bowls represent a volcano a forest and an ocean.
say('ok')                                    
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocksbowls_7" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# also imagine that the blocks are parts of the building.
say('ok')                                                 
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocksbowls_8" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# now build a tower in the forest.
order_bottom_to_top = ['green bowl', 'blue block', 'green block', 'red block']
say('stacking the blocks on the green bowl')
stack_objects_in_order(object_names=order_bottom_to_top)

# define function: stack_objects_in_order(object_names=order_bottom_to_top).
def stack_objects_in_order(object_names):
    for i in range(len(object_names) - 1):
        put_first_on_second(object_names[i + 1], object_names[i])
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_blocksbowls_9" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['red block', 'green block', 'blue block', 'red bowl', 'green bowl', 'blue bowl']
# show me what happens when a volcano erupts over the ocean.
say('putting the red bowl on the blue bowl')
put_first_on_second('red bowl', 'blue bowl')                                                                                                     
                                </code></pre>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="card mb-4 mt-4 text-dark bg-light">
                    <h5 class="card-header">Tabletop Manipulation: Fruits, Bottles, and Plates </h5>
                    <div class="card-body">
                        <p>Choose a command:</p>           
                        <select class="form-select" size="5" aria-label="size 5 select example">
                            <option value="fbp_1">
                                1) How many fruits are there?
                            </option>
                            <option value="fbp_2">
                                2) Tell me their names
                            </option>
                            <option value="fbp_3">
                                3) Are there any fruits on the green plate?
                            </option>
                            <option value="fbp_4">
                                4) Move all fruits to the green plate and bottles to the blue plate
                            </option>
                            <option value="fbp_5">
                                5) Move the smallest fruit back to the yellow plate
                            </option>
                            <option value="fbp_6">
                                6) Wait until you see an egg and put it on the green plate
                            </option>
                            <option value="fbp_7">
                                7) Put the darkest object in the plate that has the apple
                            </option>
                        </select>

                        <div class="col-md-12 mb-2">
                            <video id="vid_fbp" width="100%" preload="auto" playsinline controls>
                                <source src="videos/fruits_and_bottles.mp4" type="video/mp4">
                            </video>
                        </div>

                        <div class="row" id="content_fbp_1">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# how many fruits are there.
n_fruits = parse_question('how many fruits are there', f'objects = {get_obj_names()}')
say(f'There are {n_fruits} fruits')

objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# how many fruits are there?
fruit_names = parse_obj_name('the fruits', f'objects = {get_obj_names()}')
ret_val = len(fruit_names)
objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']

objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# the fruits.
fruit_names = ['apple', 'lemon', 'avocado']
ret_val = fruit_names
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_fbp_2" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# tell me their names.
fruit_names = parse_question('what are the fruits', f'objects = {get_obj_names()}')
say(f'The fruits are: {", ".join(fruit_names)}')

objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# what are the fruits?
fruit_names = parse_obj_name('the fruits', f'objects = {get_obj_names()}')
ret_val = fruit_names
objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']

objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# the fruits.
fruit_names = ['apple', 'lemon', 'avocado']
ret_val = fruit_names
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_fbp_3" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# are there any fruit on a green plate.
if parse_question('are there any fruit on a green plate', f'objects = {get_obj_names()}'):
    say('Yes - there is a fruit on a green plate')
else:
    say('No - there is no fruit on a green plate')

objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# are there any fruit on a green plate?
fruit_names = parse_obj_name('the fruit', f'objects = {get_obj_names()}')
green_plate_names = parse_obj_name('the green plates', f'objects = {get_obj_names()}')
ret_val = False
for fruit_name in fruit_names:
    for green_plate_name in green_plate_names:
    if bbox_contains_pt(container_name=green_plate_name, obj_name=fruit_name):
        ret_val = True
        break
objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']

objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# the fruit.
fruit_names = ['apple', 'lemon', 'avocado']
ret_val = fruit_names

objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# the green plates.
ret_val = ['green plate']

# define function: bbox_contains_pt(container_name=green_plate_name, obj_name=fruit_name).
def bbox_contains_pt(container_name, obj_name):
    container_bbox = get_bbox(container_name)
    obj_pos = get_obj_pos(obj_name)
    return container_bbox[0] <= obj_pos[0] <= container_bbox[2] and container_bbox[1] <= obj_pos[1] <= container_bbox[3]
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_fbp_4" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# move all fruits to the green plate and bottles to the blue plate.
fruit_names = parse_obj_name('fruits', f'objects = {get_obj_names()}')
bottle_names = parse_obj_name('bottles', f'objects = {get_obj_names()}')
say('Moving all fruits to the green plate and bottles to the blue plate')
for fruit_name in fruit_names:
    put_first_on_second(fruit_name, 'green plate')
for bottle_name in bottle_names:
    put_first_on_second(bottle_name, 'blue plate')

objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# fruits.
fruit_names = ['apple', 'lemon', 'avocado']
ret_val = fruit_names

objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# bottles.
ret_val = ['red bottle', 'green bottle']
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_fbp_5" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# move the smallest fruit back to the yellow plate.
smallest_fruit_name = parse_obj_name('the smallest fruit', f'objects = {get_obj_names()}')
say(f'Moving the {smallest_fruit_name} back to the yellow plate')
put_first_on_second(smallest_fruit_name, 'yellow plate')

objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# the smallest fruit.
fruit_names = ['apple', 'lemon', 'avocado']
fruit_segmasks = [get_segmask(name) for name in fruit_names]
fruit_segmask_areas = [get_segmask_area(segmask) for segmask in fruit_segmasks]
ret_val = fruit_names[np.argmin(fruit_segmask_areas)]

def get_segmask_area(object_name):
    segmask = get_segmask(object_name)
    area = np.sum(segmask)
    return area
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_fbp_6" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# wait until you see an egg and put it on the green plate.
say('Waiting until I see an egg')
while not is_obj_visible('egg'):
    pass
say('I see an egg! Putting it on the green plate')
put_first_on_second('egg', 'green plate')
                                </code></pre>
                            </div>
                        </div>
                            
                        <div class="row" id="content_fbp_7" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# put the darkest object in the plate that has the apple.
darkest_obj_name = parse_obj_name('the darkest object', f'objects = {get_obj_names()}')
apple_plate_name = parse_obj_name('the plate that has the apple', f'objects = {get_obj_names()}')
say(f'Putting the {darkest_obj_name} on the {apple_plate_name}')
put_first_on_second(darkest_obj_name, apple_plate_name)

objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# the darkest object.
obj_names = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
obj_colors = [get_color(obj_name) for obj_name in obj_names]
obj_colors = np.array(obj_colors)
darkest_idx = np.argmin(np.sum(obj_colors, axis=1))
ret_val = obj_names[darkest_idx]

objects = ['apple', 'lemon', 'avocado', 'red bottle', 'green bottle', 'blue plate', 'green plate', 'yellow plate']
# the plate that has the apple.
plate_names = ['blue plate', 'green plate', 'yellow plate']
for plate_name in plate_names:
if bbox_contains_pt(container_name=plate_name, obj_name='apple'):
    ret_val = plate_name
    break
                                </code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card mb-4 mt-4 text-dark bg-light">
                    <h5 class="card-header">Whiteboard Drawing</h5>
                    <div class="card-body">
                        <p>Choose a command:</p>        
                        <select class="form-select" size="5" aria-label="size 5 select example">
                            <option value="draw_1">
                                1) Draw a 5cm hexagon around the middle
                            </option>
                            <option value="draw_2">
                                2) Draw a line that bisects the hexagon
                            </option>
                            <option value="draw_3">
                                3) Make them both bigger
                            </option>
                            <option value="draw_4">
                                4) Erase the hexagon and the line
                            </option>
                            <option value="draw_5">
                                5) Draw the sun as a circle at the top right
                            </option>
                            <option value="draw_6">
                                6) Draw the ground as a line at the bottom
                            </option>
                            <option value="draw_7">
                                7) Draw a pyramid as a triangle on the ground
                            </option>
                            <option value="draw_8">
                                8) Draw a smaller pyramid a little bit to the left
                            </option>
                            <option value="draw_9">
                                8) Erase the sun, the ground, and the pyramid
                            </option>
                            <option value="draw_10">
                                9) Draw circles around the blocks
                            </option>
                            <option value="draw_11">
                                10) Draw a square around the sweeter fruit
                            </option>
                        </select>

                        <div class="col-md-12 mb-2">
                            <video id="vid_draw" width="100%" preload="auto" playsinline controls>
                                <source src="videos/whiteboard.mp4" type="video/mp4">
                            </video>
                        </div>

                        <div class="row" id="content_draw_1">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# draw a 5 cm hexagon around the middle.
say('ok - drawing a 5cm hexagon around the middle')
hexagon_shape_pts = parse_shape_pts('a hexagon with radius 5cm around the middle with 6 pts')
draw(hexagon_shape_pts)

# a hexagon with radius 5cm around the middle with 6 pts.
center_pos = denormalize_xy([0.5, 0.5])
hexagon_shape = make_hexagon(radius=0.05, center=center_pos)
hexagon_shape_pts = get_points_from_polygon(hexagon_shape)
ret_val = hexagon_shape_pts

# define function: hexagon_shape = make_hexagon(radius=0.05, center=center_pos).
def make_hexagon(radius, center):
    hexagon_shape = Polygon([[center[0] + radius, center[1]],
                                [center[0] + radius / 2, center[1] + radius * np.sqrt(3) / 2],
                                [center[0] - radius / 2, center[1] + radius * np.sqrt(3) / 2],
                                [center[0] - radius, center[1]],
                                [center[0] - radius / 2, center[1] - radius * np.sqrt(3) / 2],
                                [center[0] + radius / 2, center[1] - radius * np.sqrt(3) / 2]])
    return hexagon_shape

# define function: hexagon_shape_pts = get_points_from_polygon(hexagon_shape).
def get_points_from_polygon(shape):
    return np.array(shape.exterior.coords)
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_draw_2" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# draw a line that bisects the hexagon.
say('ok - drawing a line that bisects the hexagon')
hexagon_bisect_line_pts = parse_shape_pts('a line that bisects the hexagon')
draw(hexagon_bisect_line_pts)

# a line that bisects the hexagon.
center_pos = denormalize_xy([0.5, 0.5])
hexagon_shape = make_hexagon(radius=0.05, center=center_pos)
hexagon_shape_pts = get_points_from_polygon(hexagon_shape)
line_pts = np.array([hexagon_shape_pts[0], hexagon_shape_pts[3]])
ret_val = line_pts
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_draw_3" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# make them both bigger.
say('ok - making the hexagon and the line bigger by 2x')
erase(hexagon_shape_pts)
erase(hexagon_bisect_line_pts)
hexagon_shape_pts = transform_shape_pts('scale it by 2x', shape_pts=hexagon_shape_pts)
hexagon_bisect_line_pts = transform_shape_pts('scale it by 2x', shape_pts=hexagon_bisect_line_pts)
draw(hexagon_shape_pts)
draw(hexagon_bisect_line_pts)

# scale it by 2x.
new_shape_pts = scale_pts_around_centroid_np(shape_pts, scale_x=2, scale_y=2)

# scale it by 2x.
new_shape_pts = scale_pts_around_centroid_np(shape_pts, scale_x=2, scale_y=2)

# define function: new_shape_pts = scale_pts_around_centroid_np(shape_pts, scale_x=2, scale_y=2).
def scale_pts_around_centroid_np(traj_pts, scale_x=1.5, scale_y=1.5):
    centroid = np.mean(traj_pts, axis=0)
    new_traj_pts = traj_pts - centroid
    new_traj_pts[:, 0] = new_traj_pts[:, 0] * scale_x
    new_traj_pts[:, 1] = new_traj_pts[:, 1] * scale_y
    new_traj_pts = new_traj_pts + centroid
    return new_traj_pts
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_draw_4" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# erase the hexagon and the line.
say('ok - erasing the hexagon and the line')
erase(hexagon_shape_pts)
erase(hexagon_bisect_line_pts)
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_draw_5" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# draw the sun as a circle at the top right.
say('ok - drawing the sun as a circle at the top right')
sun_shape_pts = parse_shape_pts('a circle with radius 5cm at the top right with 16 pts')
draw(sun_shape_pts)

# a circle with radius 5cm at the top right with 16 pts.
top_right_corner = denormalize_xy([1, 1])
circle_shape = make_circle(radius=0.05, center=top_right_corner)
circle_shape_pts = interpolate_pts_along_exterior(exterior=circle_shape.exterior, n=16)
ret_val = circle_shape_pts

# define function: circle_shape = make_circle(radius=0.05, center=top_right_corner).
def make_circle(radius, center):
    circle = Point(center).buffer(radius)
    return circle

# define function: circle_shape_pts = interpolate_pts_along_exterior(exterior=circle_shape.exterior, n=16).
def interpolate_pts_along_exterior(exterior, n):
    pts_coords = []
    for i in range(n):
        t = i / (n - 1)
        pt = exterior.interpolate(t, normalized=True)
        pts_coords.append(pt.coords[0])
    return pts_coords
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_draw_6" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# draw the ground as a line at the bottom.
say('ok - drawing the ground as a line at the bottom')
ground_line_pts = parse_shape_pts('a horizontal line with length 20cm at the bottom')
draw(ground_line_pts)

# a horizontal line with length 20cm at the bottom.
bottom_side = denormalize_xy([0.5, 0])
start_pos = bottom_side + [-0.1, 0]
end_pos = bottom_side + [0.1, 0]
bottom_line_pts = np.array([start_pos, end_pos])
ret_val = bottom_line_pts
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_draw_7" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# draw a pyramid as a triangle on the ground.
say('ok - drawing a pyramid as a triangle on the ground')
pyramid_shape_pts = parse_shape_pts('a triangle with size 10cm on the ground')
draw(pyramid_shape_pts)

# a triangle with size 10cm on the ground.
ground_pos = denormalize_xy([0.5, 0])
triangle_shape = make_triangle(size=0.1, center=ground_pos)
triangle_shape_pts = get_points_from_polygon(triangle_shape)
ret_val = triangle_shape_pts

# define function: triangle_shape_pts = get_points_from_polygon(triangle_shape).
def get_points_from_polygon(shape):
    return np.array(shape.exterior.coords)
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_draw_8" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# draw a smaller pyramid a little bit to the left.
say('ok - drawing a smaller pyramid a little bit to the left')
smaller_pyramid_shape_pts = transform_shape_pts('move it left by 5cm and scale it by 0.5x', shape_pts=pyramid_shape_pts)
draw(smaller_pyramid_shape_pts)

# move it left by 5cm and scale it by 0.5x.
new_shape_pts = translate_pts_np(shape_pts, delta=[-0.05, 0])
new_shape_pts = scale_pts_around_centroid_np(new_shape_pts, scale_x=0.5, scale_y=0.5)

# define function: new_shape_pts = translate_pts_np(shape_pts, delta=[-0.05, 0]).
def translate_pts_np(pts, delta):
  return pts + delta

# define function: new_shape_pts = scale_pts_around_centroid_np(new_shape_pts, scale_x=0.5, scale_y=0.5).
def scale_pts_around_centroid_np(traj_pts, scale_x=1.5, scale_y=1.5):
  centroid = np.mean(traj_pts, axis=0)
  new_traj_pts = traj_pts - centroid
  new_traj_pts[:, 0] = new_traj_pts[:, 0] * scale_x
  new_traj_pts[:, 1] = new_traj_pts[:, 1] * scale_y
  new_traj_pts = new_traj_pts + centroid
  return new_traj_pts
                                </code></pre>
                            </div>
                        </div>
                        
                        <div class="row" id="content_draw_9" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# erase the sun the ground and the pyramid.
say('ok - erasing the sun the ground and the pyramid')
pts_to_erase = np.r_[sun_shape_pts, ground_line_pts, pyramid_shape_pts, smaller_pyramid_shape_pts]
erase(pts_to_erase)
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_draw_10" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# draw circles around the blocks.
say('ok - drawing circles around the blocks')
block_names = parse_obj_name('the blocks', f'objects = {get_obj_names()}')
block_circle_shape_pts = []
for block_name in block_names:
    block_circle_shape_pts.append(parse_shape_pts(f'a circle with radius 5cm around the {block_name} with 16 pts'))
for shape_pts in block_circle_shape_pts:
    draw(shape_pts)

objects = ['green block', 'orange block', 'strawberry', 'lemon']
# the blocks.
ret_val = ['green block', 'orange block']

# a circle with radius 5cm around the green block with 16 pts.
green_block_name = parse_obj_name('the green block', f'objects = {get_obj_names()}')
green_block_pos = get_obj_pos(green_block_name)
circle_shape = make_circle(radius=0.05, center=green_block_pos)
circle_shape_pts = interpolate_pts_along_exterior(exterior=circle_shape.exterior, n=16)
ret_val = circle_shape_pts

objects = ['green block', 'orange block', 'strawberry', 'lemon']
# the green block.
ret_val = 'green block'

# a circle with radius 5cm around the orange block with 16 pts.
orange_block_name = parse_obj_name('the orange block', f'objects = {get_obj_names()}')
orange_block_pos = get_obj_pos(orange_block_name)
circle_shape = make_circle(radius=0.05, center=orange_block_pos)
circle_shape_pts = interpolate_pts_along_exterior(exterior=circle_shape.exterior, n=16)
ret_val = circle_shape_pts

objects = ['green block', 'orange block', 'strawberry', 'lemon']
# the orange block.
ret_val = 'orange block'

# define function: circle_shape = make_circle(radius=0.05, center=green_block_pos).
def make_circle(radius, center):
  circle = Point(center).buffer(radius)
  return circle

# define function: circle_shape_pts = interpolate_pts_along_exterior(exterior=circle_shape.exterior, n=16).
def interpolate_pts_along_exterior(exterior, n):
  pts_coords = []
  for i in range(n):
      t = i / (n - 1)
      pt = exterior.interpolate(t, normalized=True)
      pts_coords.append(pt.coords[0])
  return pts_coords
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_draw_11" style="display:none">
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# draw a square around the sweeter fruit.
say('ok - drawing a square around the sweeter fruit')
sweeter_fruit_name = parse_obj_name('the sweeter fruit', f'objects = {get_obj_names()}')
sweeter_fruit_square_shape_pts = parse_shape_pts(f'a 10cm square around the {sweeter_fruit_name}')
draw(sweeter_fruit_square_shape_pts)

objects = ['green block', 'orange block', 'strawberry', 'lemon']
# the sweeter fruit.
ret_val = 'strawberry'

# a 10cm square around the strawberry.
strawberry_name = parse_obj_name('the strawberry', f'objects = {get_obj_names()}')
strawberry_pos = get_obj_pos(strawberry_name)
square_shape = make_square(size=0.1, center=strawberry_pos)
square_shape_pts = get_points_from_polygon(square_shape)
ret_val = square_shape_pts

objects = ['green block', 'orange block', 'strawberry', 'lemon']
# the strawberry.
ret_val = 'strawberry'

# define function: square_shape = make_square(size=0.1, center=strawberry_pos).
def make_square(size, center):
    square = Polygon([
        center + [-size/2, -size/2],
        center + [size/2, -size/2], 
        center + [size/2, size/2], 
        center + [-size/2, size/2]
    ])
    return square

# define function: square_shape_pts = get_points_from_polygon(square_shape).
def get_points_from_polygon(shape):
    return np.array(shape.exterior.coords)
                                </code></pre>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="card mb-4 mt-4 text-dark bg-light">
                    <h5 class="card-header">Mobile Robot: Navigation </h5>
                    <div class="card-body">
                        <p>Choose a command:</p>
                        <select class="form-select" size="5" aria-label="size 5 select example">
                            <option value="mobilenav_1">
                                1) Moving in a 3m by 2m rectangle around the office chair
                            </option>
                            <option value="mobilenav_2">
                                2) Do that again but rotated 45 degrees clockwise
                            </option>
                            <option value="mobilenav_3">
                                3) Go in a 1.5m square around the stool as many times as needed, check each step if there is a coca cola can, only stop moving when you see the coca cola can
                            </option>
                            <option value="mobilenav_4">
                                4) Follow the convex hull containing the chairs
                            </option>
                            <option value="mobilenav_5">
                                5) Move back and forth between the table and the countertop twice
                            </option>
                        </select>

                        <div class="row" id="content_mobilenav_1">
                            <div class="col-md-12 mb-2">
                                <video id="vid_1_mobilenav_1" width="100%" preload="auto" playsinline controls>
                                    <source src="videos/mobilenav_0_rect_phone.mp4" type="video/mp4">
                                </video>
                                <!-- <video id="vid_2_mobilenav_1" width="100%" preload="auto" playsinline controls>
                                    <source src="videos/mobilenav_0_rect_pensive.mp4" type="video/mp4">
                                </video> -->
                            </div>
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# move the robot in a 2m by 1m rectangle around the office chair.
traj = parse_position('a 2m by 1m rectangle around the office chair with 4 points')
say('ok - moving in a 2m by 1m rectangle around the office chair')
for pos in traj:
    goto_pos(pos, speed=0.5)

# a 2m by 1m rectangle around the office chair with 4 points.
office_chair_name = parse_loc_name('the office chair', f'objects = {get_loc_names()}')
office_chair_pos = get_loc_pos(office_chair_name)
shape_2d = make_rectangle(width=2, height=1, center=office_chair_pos)
points_2d = get_points_from_polygon(shape_2d)
points_3d = np.c_[points_2d, np.zeros(len(points_2d))]
ret_val = points_3d

# define function: shape_2d = make_rectangle(width=2, height=1, center=office_chair_pos).
def make_rectangle(width, height, center):
    shape_2d = box(center[0] - width / 2, center[1] - height / 2, center[0] + width / 2, center[1] + height / 2)
    return shape_2d

objects = ['table', 'countertop', 'desk', 'recycle bin', 'office chair', 'stool', 'steel chair', 'folding chair']
# the office chair.
ret_val = 'office chair'
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_mobilenav_2" style="display:none">
                            <div class="col-md-12 mb-2">
                                <video id="vid_1_mobilenav_2" width="100%" preload="auto" playsinline controls>
                                    <source src="videos/mobilenav_1_rect_phone.mp4" type="video/mp4">
                                </video>
                                <!-- <video id="vid_2_mobilenav_2" width="100%" preload="auto" playsinline controls>
                                    <source src="videos/mobilenav_1_rect_pensive.mp4" type="video/mp4">
                                </video> -->
                            </div>
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# do that again but rotated 45 degrees clockwise.
traj = transform_traj('rotate it 45 degrees clockwise', traj_pts=traj)
say('no problem - rotating the rectangle 45 degrees clockwise')
for pos in traj:
    goto_pos(pos, speed=0.5)

# rotate it 45 degrees clockwise.
new_traj_pts = rotate_3d_pts_around_centroid_np(traj_pts, angle_z=-np.deg2rad(45))

# define function: new_traj_pts = rotate_3d_pts_around_centroid_np(traj_pts, angle_z=(- np.deg2rad(45))).
def rotate_3d_pts_around_centroid_np(traj_pts, angle_z):
    centroid = np.mean(traj_pts, axis=0)
    traj_pts_centered = traj_pts - centroid
    traj_pts_rotated = np.dot(traj_pts_centered, np.array([[np.cos(angle_z), -np.sin(angle_z), 0], [np.sin(angle_z), np.cos(angle_z), 0], [0, 0, 1]]))
    traj_pts_rotated_and_centered = traj_pts_rotated + centroid
    return traj_pts_rotated_and_centered
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_mobilenav_3" style="display:None">
                            <div class="col-md-12 mb-2">
                                <video id="vid_1_mobilenav_3" width="100%" preload="auto" playsinline controls>
                                    <source src="videos/mobilenav_2_coke_phone.mp4" type="video/mp4">
                                </video>
                                <!-- <video id="vid_2_mobilenav_3" width="100%" preload="auto" playsinline controls>
                                    <source src="videos/mobilenav_2_coke_pensive.mp4" type="video/mp4">
                                </video> -->
                            </div>
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# go in a 1.5m square around the stool as many times as needed, check each step if there is a coca cola can, only stop moving when you see it.
say('ok - going in a 1.5m square around the stool as many times as needed, checking each step if there is a coca cola can, only stopping when I see it')
traj = parse_position('a 1.5m square around the stool with 4 points')
while True:
    for pos in traj:
    goto_pos(pos)
    if is_obj_visible('coca cola can', loc='stool'):
        break
    if is_obj_visible('coca cola can', loc='stool'):
    break
say('I see the coca cola can')
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_mobilenav_4" style="display:None">
                            <div class="col-md-12 mb-2">
                                <video id="vid_1_mobilenav_4" width="100%" preload="auto" playsinline controls>
                                    <source src="videos/mobilenav_3_convex_hull_phone.mp4" type="video/mp4">
                                </video>
                                <!-- <video id="vid_2_mobilenav_4" width="100%" preload="auto" playsinline controls>
                                    <source src="videos/mobilenav_3_convex_hull_pensive.mp4" type="video/mp4">
                                </video> -->
                            </div>
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# follow a 2x scaled up convex hull containing the chairs.
traj = parse_position('a 2x scaled up convex hull containing the chairs with 20 points')
say('ok - moving in a 2x scaled up convex hull containing the chairs')
follow_traj(traj, speed=0.5)

# define function: follow_traj(traj, speed=0.5).
def follow_traj(traj, speed=0.5):
    for pt in traj.coords:
        yield pt

# a 2x scaled up convex hull containing the chairs with 20 points.
chair_names = parse_obj_name('the chairs', f'objects = {get_loc_names()}')
chair_positions = np.array([get_loc_pos(chair_name) for chair_name in chair_names])
shape_2d = make_convex_hull(points=chair_positions[:, :2])
shape_2d = scale(shape_2d, xfact=2, yfact=2)
points_2d = interpolate_pts_along_exterior(exterior=shape_2d.exterior, n=20)
points_3d = np.c_[points_2d, np.zeros(len(points_2d))]
ret_val = points_3d

# define function: shape_2d = make_convex_hull(points=chair_positions[:, :2]).
def make_convex_hull(points):
    return MultiPoint(points).convex_hull

# define function: points_2d = interpolate_pts_along_exterior(exterior=shape_2d.exterior, n=20).
def interpolate_pts_along_exterior(exterior, n):
    pts = []
    for i in range(n):
        t = i / (n - 1)
        pt = np.array(exterior.interpolate(t, normalized=True).coords[0])
        pts.append(pt)
    return pts

objects = ['table', 'countertop', 'desk', 'recycle bin', 'office chair', 'stool', 'wood chair']
# the chairs.
ret_val = ['office chair', 'stool', 'wood chair']                                    
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_mobilenav_5" style="display:None">
                            <div class="col-md-12 mb-2">
                                <video id="vid_1_mobilenav_5" width="100%" preload="auto" playsinline controls>
                                    <source src="videos/mobilenav_4_back_and_forth_phone.mp4" type="video/mp4">
                                </video>
                                <!-- <video id="vid_2_mobilenav_5" width="100%" preload="auto" playsinline controls>
                                    <source src="videos/mobilenav_4_back_and_forth_pensive.mp4" type="video/mp4">
                                </video> -->
                            </div>
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# move back and forth between the table and the countertop twice.
say('ok - moving back and forth between the table and the countertop twice')
for _ in range(2):
    goto_loc('table')
    goto_loc('countertop')
                                </code></pre>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="card mb-4 mt-4 text-dark bg-light">
                    <h5 class="card-header">Mobile Robot: Manipulation </h5>
                    <div class="card-body">
                        <p>Choose a command:</p>
                        <select class="form-select" size="3" aria-label="size 3 select example">
                            <option value="mobilemnp_1">
                                1) Put way the coca cola can and the apple on their corresponding bins
                            </option>
                            <option value="mobilemnp_2">
                                2) Take the coca cola can from the desk and put it in the middle of the fruits on the table
                            </option>
                            <option value="mobilemnp_3">
                                3) How many fruits are on the table?
                            </option>
                        </select>

                        <div class="row" id="content_mobilemnp_1">
                            <div class="col-md-12 mb-2">
                                <video id="vid_1_mobilemnp_1" width="100%" preload="auto" playsinline controls>
                                    <source src="videos/mobilemnp_sort_trash_4x_stab_narrated.mp4" type="video/mp4">
                                </video>
                            </div>
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# This is the compost bin.
compost_bin_pos, compost_bin_angle = get_robot_pos_and_angle()
compost_bin_name = 'compost bin'
say('ok')

# This is the recycle bin.
recycle_bin_pos, recycle_bin_angle = get_robot_pos_and_angle()
recycle_bin_name = 'recycle bin'
say('ok')

# This is the landfill bin.
landfill_bin_pos, landfill_bin_angle = get_robot_pos_and_angle()
landfill_bin_name = 'landfill bin'
say('ok')

# The coke can and the apple are on the table.
coke_can_loc = 'table'
apple_loc = 'table'
say('ok')

# Put way the coke can and the apple on their corresponding bins.
say('got it - putting the coke can and the apple on their corresponding bins')
goto_loc(coke_can_loc); pick_obj('coke can')
goto_pos(recycle_bin_pos, angle=recycle_bin_angle)
place_at_obj(recycle_bin_name)
goto_loc(apple_loc); pick_obj('apple')
goto_pos(compost_bin_pos, angle=compost_bin_angle)
place_at_obj(compost_bin_name)
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_mobilemnp_2" style="display:none">
                            <div class="col-md-12">
                                <video id="vid_1_mobilemnp_2" width="100%" preload="auto" playsinline controls>
                                    <source src="videos/mobilemnp_coke_between_fruit_4x_stab.mp4" type="video/mp4">
                                </video>
                            </div>
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# take the coca cola can from the cart and put it in the middle of the fruits on the table.
say('sure - taking the coca cola can from the cart and putting it in the middle of the fruits on the table')
water_bottle_loc = 'cart'
goto_loc(water_bottle_loc); pick_obj('coca cola can')
fruits_loc = 'table'
goto_loc(fruits_loc); target_pos = parse_position('a point in the middle of the fruits')
place_at_pos(target_pos)

# a point in the middle of the fruits.
fruit_names = parse_obj_name('the fruits', f'objects = {get_visible_obj_names()}')
fruit_positions = np.array([get_obj_pos(fruit_name) for fruit_name in fruit_names])
ret_val = np.mean(fruit_positions, axis=0)

objects = ['chips bag', 'apple', 'banana']
# the fruits.
ret_val = ['apple', 'banana']
                                </code></pre>
                            </div>
                        </div>

                        <div class="row" id="content_mobilemnp_3" style="display:none">
                            <div class="col-md-12 mb-2">
                                <video id="vid_1_mobilemnp_3" width="100%" preload="auto" playsinline controls>
                                    <source src="videos/mobilemnp_how_many_fruits_phone.mp4" type="video/mp4">
                                </video>
                            </div>
                            <div class="col-md-12">
                                <p>Code generated by our Language Model Program:</p>
                                <pre><code class="language-python">
# how many fruits are on the table.
say('ok - looking for fruits on the table')
goto_loc('table')
snack_names = parse_obj_name('the fruits', f'objects = {get_visible_obj_names()}')
say(f'I see {len(snack_names)} fruits')

objects = ['chips bag', 'water bottle', 'coca cola can', 'apple', 'oreo cookies', 'banana']
# the fruits.
ret_val = ['banana', 'apple']
                                </code></pre>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        
        <div class="row justify-content-md-center">
            <div class="col-md-10 col-lg-8">
                <h3>
                    Citation 
                </h3> 
                <a href="https://arxiv.org/abs/??">[arxiv version]</a>
                <div class="form-group col-md-12">
                    <textarea id="bibtex" class="form-control" readonly>
@inproceedings{codeaspolicies2022,
    title={Code as Policis: Language Model Programs for Embodied Control},
    author={Jacky Liang and Wenlong Huang and Fei Xia and Peng Xu and Karol Hausman and Brian Ichter and Pete Florence and Andy Zeng},
    booktitle={arXiv preprint arXiv:??},
    year={2022}
}</textarea>
                </div>
            </div>
        </div>

        <div class="row justify-content-md-center mt-4">
            <div class="col-md-10 col-lg-8">
                <h3>
                    Acknowledgements
                </h3>
                <p class="text-justify">
                    Special thanks to Vikas Sindhwani, Vincent Vanhoucke for helpful feedback on writing, Chad Boodoo for operations and hardware support.
                </p>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>hljs.highlightAll();</script>
</body>
</html>
